function assert(a,b){if(!a)throw new Error(b||"failed")}function AuthorizationError(a){this.name="Not Authorized",this.message=a||"Not authorized for the current user (no matching authorization token)",this.stack=(new Error).stack}define(["backbone","Session","Router","config","Views/Root"],function(a,b,c,d,e){var f={init:function(){var g=window.localStorage.getItem("token");return g&&g.length>9?b.authenticationtoken=g:window.location="/login.html",b.loadEssentialData(function(){f.RootView=new e,f.RouterInstance=new c,a.history.start()}),this.config=d,this},getRootView:function(){return e},hasToken:function(){Store.get("settings","token",function(a){a?f.hello():(f.setloginwindow(),window.addEventListener("message",f.receiveToken,!1))})},receiveToken:function(a){a.origin===window.location.origin&&Store.set("settings",{key:"token",value:a.data},hello)},setloginwindow:function(){$("iframe").get(0).src=d.authurl+"authorize?response_type=token&state=xyz&client_id="+d.appid+"&redirect_uri="+encodeURIComponent(origin()+"/auth.html")},hello:function(){window.location="/"}};return a.ajax=function(){return b.authenticationtoken&&(arguments[0].headers={Authorization:"Bearer "+b.authenticationtoken,Accept:"application/json"}),a.$.ajax.apply(a.$,arguments)},a.Model=a.Model.extend({url:function(){return this.endpoint?f.config.apiurl+"resellers/"+this.typestring+"/"+this.id+this.endpoint:f.config.apiurl+this.typestring+"/"+this.id},sync:function(b,c,d){return"update"==b?!1:a.sync(b,c,d)}}),f}),define(["backbone","backbone.paginator","Models/Account"],function(a,b,c){var d=b.extend({typestring:"accounts",model:c,url:function(){this.parentmodel&&!this.parenttype&&(this.parenttype=this.parentmodel.get("objectType"));var a=this.parentmodel?Cloudwalkers.config.apiurl+"resellers/1/"+this.parenttype+"/"+this.parentmodel.id:Cloudwalkers.config.apiurl+"resellers/1/"+this.typestring;return this.endpoint&&(a+="/"+this.endpoint),this.parameters?a+"?"+$.param(this.parameters):a},sync:function(b,c,d){return"update"==b?!1:a.sync(b,c,d)},parse:function(a){return a.reseller.accounts},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.fetch())}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])}});return d}),define(["backbone","backbone.paginator","Models/Account"],function(a,b,c){var d=b.extend({typestring:"plans",model:c,url:function(){this.parentmodel&&!this.parenttype&&(this.parenttype=this.parentmodel.get("objectType"));var a=this.parentmodel?Cloudwalkers.config.apiurl+"resellers/1/"+this.parenttype+"/"+this.parentmodel.id:Cloudwalkers.config.apiurl+"resellers/1/"+this.typestring;return this.endpoint&&(a+="/"+this.endpoint),this.parameters?a+"?"+$.param(this.parameters):a},sync:function(b,c,d){return"update"==b?!1:a.sync(b,c,d)},parse:function(a){return a.reseller.plans},updates:function(a){for(var b in a){var c=this.get(a[b]);c&&(Store.set(this.typestring,{id:a[b],outdated:!0}),c.fetch())}},outdated:function(a){if(!a)return this.filter(function(a){return a.outdated});this.updates([a])}});return d}),define(["backbone","Cloudwalkers","Session"],function(a,b,c){var d=a.Model.extend({typestring:"accounts",parse:function(a){return a.account?a.account:a},url:function(){return b.config.apiurl+"json/account/"+this.id+this.endpoint},sync:function(b,c,d){return a.sync(b,c,d)},firstload:function(){$.each(this.get("channels"),function(a,b){c.storeChannel(b)})},activate:function(){Store.exists("channels")||this.firstload(),Store.filter("streams",null,function(a){this.streams.add(a)}.bind(this)),Store.filter("channels",null,function(a){this.channels.add(a)}.bind(this)),Store.filter("campaigns",null,function(a){this.campaigns.add(a)}.bind(this)),Store.filter("users",null,function(a){this.users.add(a)}.bind(this)),Store.filter("messages",null,function(a){this.messages.add(a)}.bind(this)),Store.filter("statistics",null,function(a){this.statistics.add(a)}.bind(this)),Store.filter("reports",null,function(a){this.reports.add(a)}.bind(this)),this.get("plan")&&(this.limits=this.get("plan").limits),this.ping=new c.Ping({id:this.id})},monitorlimit:function(a,c,d){return c>=this.limits[a]?($(".alert-info").remove(),b.RootView.information("Upgrade?","You're fresh out of "+a+" slots, maybe you should upgrade."),d&&("string"==typeof d&&(d=$(d)),d.addClass("limited").attr("disabled",!0)),!0):($("[disabled].limited").size()&&($("[disabled].limited").removeClass("limited").attr("disabled",!1),$("[data-dismiss=alert]").click()),!1)},addcampaign:function(a,b){var c=this.get("campaigns");c.map(function(a){return a.name}).indexOf(a)<0&&(c.push({name:a}),this.save({campaigns:c},{patch:!0,wait:!0,success:b}))},removecampaign:function(a,b){var c=this.get("campaigns");c.forEach(function(b,d){b.id==a&&c.splice(d,1)}),this.save({campaigns:c},{patch:!0,wait:!0,success:b})}});return d}),define(["Cloudwalkers","Session","Collections/Accounts","Models/User"],function(a,b,c,d){var e=d.extend({initialize:function(){this.once("change",this.activate),this.on("change:id",function(){this.previous("id")&&b.home()})},url:function(){return"/me.json"},parse:function(a){return a.user},firstload:function(a){return a.settings.currentAccount||(a.settings={currentAccount:a.accounts[0].id}),a},activate:function(){return this.get("accounts").length?void Store.filter("accounts",null,function(a){this.accounts=new c(a),this.account=this.getCurrentAccount(),this.account.activate(),this.set("level",Number(this.account.get("currentuser").level)),this.set("rolegroup",Number(this.account.get("currentuser").rolegroup)),this.authorized=this.account.get("currentuser").authorized,this.removerole("ACCOUNT_TAGS_MANAGE"),this.removerole("ACCOUNT_TAGS_VIEW"),this.parseauthorized(),this.censuretokens=this.censure(this.authorized),this.trigger("activated")}.bind(this)):a.RootView.exception(401)},isauthorized:function(a){return _.isArray(a)?0!==_.intersection(this.authorized,a).length:_.contains(this.authorized,a)},removerole:function(a){var b=this.authorized.indexOf(a);b>=0&&this.authorized.splice(b-1,b+1)},censure:function(a){var b={};for(var c in a)b[a[c]]=!0;return b},parseauthorized:function(){this.isauthorized(["MESSAGE_OUT_EDIT_OWN","MESSAGE_ACTIONS"])&&this.authorized.push("_CW_COWORKERS_VIEW"),this.isauthorized(["MESSAGE_READ_INBOX_MESSAGES","MESSAGE_READ_INBOX_NOTIFICATIONS","MESSAGE_READ_SCHEDULE","MESSAGE_READ_DRAFTS","ACCOUNT_NOTES_VIEW"])&&this.authorized.push("_CW_INBOX_VIEW")},offline:function(){Store.exists("me")&&this.trigger("change")},getCurrentAccount:function(){var a=b.get("currentAccount");a||(a=this.accounts.at(0).id,this.save({settings:{currentAccount:a}}));var c=this.accounts.get(Number(a));return c&&c.id?c:(this.save({settings:{currentAccount:this.accounts.at(0).id}}),b.home())}});return e}),define(["underscore","backbone","Cloudwalkers","Session"],function(a,b,c,d){var e=b.Model.extend({typestring:"users",url:function(){return this.parent?c.config.apiurl+this.parent.typestring+"/"+this.parent.id+"/"+this.typestring+"/"+this.id:c.config.apiurl+this.typestring+this.id},filterData:function(a){var b=this.attributes;return"listitem"==a?b.arrow=!0:b.role=this.getRole(),b},getRole:function(){var e=d.getAccount().get("roles"),f=this.get("rolegroup");if(!e||a.isUndefined(f))return c.RootView.resync("#"+b.history.fragment);var g=e.filter(function(a){return a.id==f});return g.length?g[0]:null}});return e}),define(["backbone","Session","Views/Dashboard","Views/Accounts","Views/Plans","Views/Little"],function(a,b,c,d,e,f){var g=a.Router.extend({routes:{statistics:"statistics",accounts:"accounts","accounts/plans":"accounts_plans",users:"users","users/roles":"users_roles","performance/little":"little_ken",performance:"performance","performance/servers":"performance_servers","performance/logs":"performance_logs",logout:"logout","*path":"dashboard"},dashboard:function(){Cloudwalkers.RootView.setView(new c)},statistics:function(){this.navigate("#dashboard",!0)},firsttime:function(){Cloudwalkers.RootView.setView(new Cloudwalkers.Views.Firsttime)},exception:function(){},accounts:function(){Cloudwalkers.RootView.setView(new d)},accounts_plans:function(){Cloudwalkers.RootView.setView(new e)},users:function(){this.navigate("#dashboard",!0)},users_roles:function(){this.navigate("#dashboard",!0)},little_ken:function(){Cloudwalkers.RootView.setView(new f)},streams_scheduling:function(){this.navigate("#dashboard",!0)},performance:function(){this.navigate("#dashboard",!0)},performance_servers:function(){this.navigate("#dashboard",!0)},performance_logs:function(){this.navigate("#dashboard",!0)},logout:function(){$.ajax({url:Cloudwalkers.config.authurl+"revoke",headers:{Authorization:"Bearer "+b.authenticationtoken,Accept:"application/json"},success:function(){window.location="/"}}),Cloudwalkers.RootView.view.remove(),Cloudwalkers.RootView.navigation.remove(),window.localStorage.clear()}});return g}),define(["Cloudwalkers","Models/Me","Collections/Accounts"],function(a,b,c){return Session={user:null,resynced:!1,initialize:function(){this.accounts=new c},isLoaded:function(){return null!=this.user},loadEssentialData:function(a){this.user=new b,this.user.fetch({success:a,error:this.logout})},refresh:function(){console.log("Session.refresh triggered")},reset:function(){window.localStorage.clear()},home:function(){a.Router.Instance.home()},logout:function(){window.localStorage.clear(),this.authenticationtoken&&Store.remove("settings","token",function(){console.log("logged out")})},updateSetting:function(a,b,c){Session.user.attributes.settings[a]!=b&&(Session.user.attributes.settings[a]=b,c=$.extend(c,{patch:!0})||{patch:!0},Session.user.save({settings:Session.user.attributes.settings},c))},get:function(a){return this.user.get("settings")[a]},clone:function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)b[c]=this.clone(a[c]);return b},viewsettings:function(b,c){var d="account_"+this.getAccount().id;Session.user.attributes.settings.viewsettings||(Session.user.attributes.settings.viewsettings={}),Session.user.attributes.settings.viewsettings[d]||(Session.user.attributes.settings.viewsettings[d]=a.RootView.navigation.mapViews());var e=this.clone(this.get("viewsettings"));if(c){if(b&&c)return e[d][b]=$.extend(e[d][b],c),this.updateSetting("viewsettings",e),e[d][b];throw TypeError("Not the right parameters were met for function viewsettings")}return e[d][b]},manage:function(){var a=Store.count("messages");a>200&&Store.filter("messages",null,function(a){a.sort(function(a,b){return a.stamp>b.stamp?1:a.stamp<b.stamp?-1:0}),a=a.slice(0,100),Store.write("messages",a),Store.filter("touches",null,function(a){var b=Session.getPing().cursor;a=a.filter(function(a){return a.ping==b}),Store.write("touches",a)})});var b=Store.count("reports");b>25&&Store.filter("reports",null,function(a){a.sort(function(a,b){return a.stamp>b.stamp?1:a.stamp<b.stamp?-1:0}),a=a.slice(0,10),Store.write("messages",a)})},isAuthorized:function(a){return a?this.user.isauthorized(a):this.user.authorized},censuretemplate:function(a){a||(a={});var b=this.getUser().censuretokens;a.authorized=b},getPing:function(){return this.user.account.ping},ping:function(a){this.user.account.ping.forceping(a)},getAccount:function(a){return a?this.user.accounts.get(a):this.user.account},getAccounts:function(){return this.user.accounts},getChannel:function(a){return"number"==typeof a?this.user.account.channels.get(a):this.user.account.channels.findWhere({type:a})},getChannels:function(){return this.user.account.channels},storeChannel:function(a){a.channels&&a.channels.length&&(a.channels=a.channels.map(function(a){return Session.storeChannel(a),a.id})),a.streams&&a.streams.length&&(a.streams=a.streams.map(function(a){return Store.post("streams",a),a.id})),Store.post("channels",a)},getStream:function(a){return"number"==typeof a?this.user.account.streams.get(a):this.user.account.streams.findWhere({token:a})},getStreams:function(){return this.user.account.streams},getUser:function(a){return a?this.user.account.users.get(a):this.user},getUsers:function(){return this.user.account.users},getContact:function(a){return this.user.account.contacts.get(a)},getContacts:function(){return this.user.account.contacts},getMessage:function(a){return this.user.account.messages.get(a)},getMessages:function(){return this.user.account.messages},getCannedResponse:function(a){return this.user.account.cannedresponses.get(a)},getCannedResponses:function(){return this.user.account.cannedresponses},getNotification:function(a){return this.user.account.notifications.get(a)},getNotifications:function(){return this.user.account.notifications},getStatistic:function(a){return this.user.account.statistics.get(a)},getStatistics:function(){return this.user.account.statistics},getReport:function(a){return this.user.account.reports.get(a)},getReports:function(){return this.user.account.reports},getComment:function(a){return this.user.account.comments.get(a)},getComments:function(){return this.user.account.comments},setLang:function(){var a,b=this.user.attributes.locale;moment.lang(b),a=new Polyglot,a.fetch({success:function(){this.translationLang=a.get("translation"),this.polyglot=new Polyglot({phrases:this.translationLang}),this.trigger("translation:done")}.bind(this)})}},_.extend(Session,Backbone.Events),Session});var StorageClassIDB=function(a,b,c){var d,e=indexedDB.open(a,b),f=function(a){console.log("IndexedDB error.",a)};e.onerror=function(){console.log("IndexedDB locked.")},e.onsuccess=function(){d=e.result,d.onerror=f,c&&c()},e.onupgradeneeded=IDBstores,this.get=function(a,b,c){var e=d.transaction([a]);e.onerror=f;var g=e.objectStore(a),h=g.get(b);return h.onerror=f,h.onsuccess=function(){c(h.result)},this},this.filter=function(){return this},this.exists=function(){return exists},this.post=function(a,b,c){var d=JSON.parse(window.localStorage.getItem(a));return d||(d=[]),d.push(b),window.localStorage.setItem(a,JSON.stringify(d)),c&&c(b,d.length-1),this},this.postCollection=function(a,b,c){var d=JSON.parse(window.localStorage.getItem(a));return d||(d=[]),b.each(function(a){d.push(a.attributes)}),window.localStorage.setItem(a,JSON.stringify(d)),c&&c(content,d.length),this},this.write=function(a,b,c){return window.localStorage.setItem(a,JSON.stringify(b)),c&&c(b),this},this.set=function(a,b,c){if(b){Array.isArray(b)||(b=[b]);var e=d.transaction([a],"readwrite");e.oncomplete=c,e.onerror=f;var g=e.objectStore(a);for(var h in b)var i=g.put(b[h]);return this}},this.update=function(){return this},this.updateById=function(){return this},this.remove=function(a,b,c,e){var f=d.transaction([a],"readwrite").objectStore(a)["delete"](b);return e&&(f.onsuccess=e),this},this.count=function(a){var b=JSON.parse(window.localStorage.getItem(a));return b?b.length:0},this.calc=function(){var a=0;for(var b in localStorage){var c=2*localStorage[b].length/1024/1024;a+=c,console.log(b,c.toFixed(4)+" MB")}return console.log("Total localStorage",a.toFixed(2)+" MB"),a.toFixed(2)}},IDBstores=function(a){console.log("Upgrading IDB.");var b,c=a.target.result;b=c.createObjectStore("settings",{keyPath:"key"}),b=c.createObjectStore("me",{keyPath:"id"}),b=c.createObjectStore("accounts",{keyPath:"id"}),b=c.createObjectStore("channels",{keyPath:"id"}),b.createIndex("type","type",{unique:!1}),b=c.createObjectStore("streams",{keyPath:"id"}),b.createIndex("type","token",{unique:!1}),b=c.createObjectStore("messages",{keyPath:"id"}),b.createIndex("stream","stream",{unique:!1}),b=c.createObjectStore("notifications",{keyPath:"id"}),b.createIndex("stream","stream",{unique:!1}),b=c.createObjectStore("users",{keyPath:"id"}),b.createIndex("name","displayname",{unique:!1}),b=c.createObjectStore("contacts",{keyPath:"id"}),b.createIndex("name","displayname",{unique:!1}),b=c.createObjectStore("campaigns",{keyPath:"id"}),b=c.createObjectStore("ping",{keyPath:"id"}),b=c.createObjectStore("touches",{keyPath:"id"})};Cloudwalkers.Session.Ping=Backbone.Model.extend({interval:3e4,min:1e4,max:9e4,timeout:0,cursor:!1,parameters:{},initialize:function(){Store.exists("ping",{id:this.id})||Store.post("ping",{id:this.id}),this.setCursor(!1),this.fetch({success:this.schedule.bind(this),error:this.toing}),this.on("change:paging",this.setCursor,this),this.on("change:updates",this.updateModels,this),this.on("change:add",this.addModels,this),this.on("change:remove",this.removeModels,this),this.listenTo(Cloudwalkers.Session,"ping",this.forceping)},ping:function(a){this.fetch({success:a?a:this.schedule.bind(this),error:this.toing.bind(this)})},setCursor:function(a,b){a?(this.interval+=Math.round(.2*(this.min-this.interval)),this.cursor=b.cursors.after,Store.set("ping",{id:this.id,cursor:this.cursor})):Store.get("ping",{id:this.id},function(a){a&&(this.cursor=a.cursor)}.bind(this))},url:function(){return this.cursor&&(this.parameters.after=this.cursor),CONFIG_BASE_URL+"json/account/"+this.id+"/ping?"+$.param(this.parameters)},parse:function(a){return a.pong},updateModels:function(a,b){b.accounts&&Cloudwalkers.Session.getAccounts().updates(b.accounts),b.streams&&Cloudwalkers.Session.getStreams().updates(b.streams),b.messages&&Cloudwalkers.Session.getMessages().updates(b.messages),b.notifications&&Cloudwalkers.Session.getNotifications().updates(b.notifications),b.users&&Cloudwalkers.Session.getUsers().updates(b.users),b.contacts&&Cloudwalkers.Session.getContacts().updates(b.contacts)},addModels:function(a,b){return b.length?void console.log("ping add callback: ",b):null},removeModels:function(a,b){return b.length?void console.log("ping remove callback: ",b):null},request:function(){window.clearTimeout(this.timeout),this.fetch({success:this.schedule.bind(this),error:this.toing.bind(this)})},schedule:function(){this.timeout=setTimeout(this.ping.bind(this),this.timer())},forceping:function(a){clearTimeout(this.timeout),this.schedule(),this.ping(a)},timer:function(){return this.interval+=Math.round(.05*(this.max-this.interval))},toing:function(){Cloudwalkers.RootView.growl(this.translateString("ping"),this.translateString("there_is_no_pong")),this.interval=this.max,this.schedule()},translateString:function(a){return Cloudwalkers.Session.polyglot.t(a)}}),define(["mustache","Views/Pageview","Views/Panels/AccountsGrid"],function(a,b,c){var d=b.extend({title:"Accounts Overview",render:function(){this.$el.html(a.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#container").eq(0);var b=new c({editable:!0,limit:20,title:!1});return this.appendWidget(b,12),this}});return d}),define(["mustache","Views/Pageview","Views/Panels/AccountsGrid","Views/Panels/Status3dParty"],function(a,b,c,d){var e=b.extend({title:"Dashboard",render:function(){this.$el.html(a.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#container").eq(0);var b=new c({editable:!1,limit:10,title:"Recent Accounts"});this.appendWidget(b,9);var e=new d;return this.appendWidget(e,3),this}});return e}),define(["mustache","Session","Views/Pageview"],function(a,b,c){var d=c.extend({title:"Little Ken",initialize:function(){},render:function(){return this.$el.html(a.render(Templates.little_ken,{title:this.title})),this.$container=this.$el.find("#container").eq(0),$.ajax("/call-ken.php",{success:this.fill.bind(this),error:this.fail,headers:{Authorization:"Bearer "+b.authenticationtoken,Accept:"application/json"}}),this},fill:function(a){var b=a.split("\n");b.shift(),b.shift(),this.$container.find(".alert-info").html(b.shift()),b.shift(),this.$container.find(".highlight code").append(b.join("<br>"))},fail:function(){this.$container.find(".alert-info").removeClass("alert-info").addClass("alert-danger").html("Woops. Little Ken tripped.")}});return d}),define(["backbone","mustache","Session"],function(a,b,c){var d=a.View.extend({events:{},initialize:function(){this.$header=$(".navbar-fixed-top").first()},render:function(){var a;return this.$el.html(b.render(Templates.navigation,a)),this.handleSidebarMenu(),this.handleHeader(),this},handleHeader:function(){this.$header.find(".profile-avatar").css("background-image","url("+c.user.get("avatar")+")")},handleSidebarMenu:function(){var b=a.history.fragment;return b?void this.setActive(b):null},setActive:function(a){$("#sidebar .active").removeClass("active"),$('a[href="#'+a+'"]').parents("#sidebar .page-sidebar-menu *").addClass("active")}});return d}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({title:"Page",className:"container-fluid",span:0,widgets:[],widgetviews:[],events:{rendered:"bubblerender",remove:"destroy"},render:function(){return this.$el.html(b.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#widgetcontainer").eq(0),this.appendWidgets(),this},appendWidgets:function(){for(var a in this.widgets){var b=this.widgets[a].view(this.widgets[a].data);this.appendWidget(b,this.widgets[a].size)}},appendWidget:function(a,b){this.span&&0!==b||this.$container.append(Templates.row),this.span=b+this.span<12?b+this.span:0,a&&(this.$container.children().last().append(a.render().el),this.widgetviews.push(a),a.$el.addClass("col-md-"+b),a.negotiateFunctionalities&&a.negotiateFunctionalities())},appendhtml:function(a){this.$container.children().last().append(a)},cleanviews:function(){this.widgetviews.length&&(this.destroy(),this.widgetviews=[])},bubblerender:function(){this.trigger("rendered"),$.each(this.widgetviews,function(a,b){b.trigger("rendered")})},destroy:function(){$.each(this.widgetviews,function(a,b){b.remove()})}});return c}),define(["backbone","mustache"],function(a,b){var c=a.View.extend({title:"Panel",events:{remove:"destroy"},initialize:function(a){a&&$.extend(this,a)},render:function(){var a={title:this.title};return this.$el.html(b.render(Templates.panel,a)),this.$container=this.$el.find(".panel-body").eq(0),this}});return c}),define(["Views/Panel","mustache","backgrid","paginator","backgrid-object-cell","Collections/Accounts"],function(a,b,c,d,e,f){var g=a.extend({limit:20,editable:!0,render:function(){var a={title:this.title};this.$el.html(b.render(Templates.accountsgrid,a)),this.collection=new f([],{state:{order:-1,pageSize:this.limit,firstPage:0,currentPage:0},queryParams:{currentPage:"current_page",pageSize:"records"}});var d=c.Extension.ObjectCell.extend({formatter:{fromRaw:function(a){return a.name}},schema:[{name:"id",label:"id"},{name:"name",label:"Plan"},{name:"limits",label:"Limits"}]}),e=c.Extension.ArrayObjectCell.extend({formatter:{fromRaw:function(a){return _.map(a,function(a){return a.name}).join(", ")}},gridOptions:{className:"backgrid table-bordered",columns:[{name:"id",label:"id",cell:"string"},{name:"name",label:"Role",cell:"string"},{name:"template",label:"template",cell:"string"}]}}),g=[{name:"id",label:"id",editable:!1,cell:c.IntegerCell.extend({orderSeparator:""})},{name:"name",label:"Account",cell:"string",editable:this.editable},{name:"plan",label:"Plan",cell:d,editable:this.editable},{name:"roles",label:"Roles",cell:e,editable:this.editable},{name:"firstTime",label:"Logged",cell:"integer",editable:this.editable}],h=new c.Grid({columns:g,collection:this.collection,width:"100%"}),i=new c.Extension.Paginator({collection:this.collection});return this.$el.find(".backgrid-container").append(h.render().el),this.$el.find(".backgrid-paginator").append(i.render().$el),this.collection.fetch({reset:!0}),this}});return g}),define(["Views/Panel","mustache","backgrid","paginator","backgrid-object-cell","Collections/Plans"],function(a,b,c,d,e,f){var g=a.extend({limit:20,editable:!0,render:function(){var a={title:this.title};this.$el.html(b.render(Templates.accountsgrid,a)),this.collection=new f([],{state:{order:-1,pageSize:this.limit,firstPage:0,currentPage:0},queryParams:{currentPage:"current_page",pageSize:"records"}});var d=c.Extension.ObjectCell.extend({formatter:{fromRaw:function(a){return newlimit=[],_.map(a,function(a,b){newlimit.push({name:b,value:a})}),_.map(newlimit,function(a){return a.name+": "+a.value}).join(", ")}},schema:[{name:"admins",label:"Admins",cell:"number"},{name:"following",label:"Following",cell:"number"},{name:"keywords",label:"Keywords",cell:"number"},{name:"services",label:"Services",cell:"number"},{name:"users",label:"Users",cell:"number"}]}),e=[{name:"id",label:"id",editable:!1,cell:c.IntegerCell.extend({orderSeparator:""})},{name:"name",label:"Name",cell:"string",editable:this.editable},{name:"limits",label:"Limits",cell:d,editable:this.editable}],g=new c.Grid({columns:e,collection:this.collection,width:"100%"}),h=new c.Extension.Paginator({collection:this.collection});return this.$el.find(".backgrid-container").append(g.render().el),this.$el.find(".backgrid-paginator").append(h.render().$el),this.collection.fetch({reset:!0}),this}});return g}),define(["Views/Panel","mustache"],function(a,b){var c=a.extend({services:[{title:"3d Party Services"},{name:"GitHub API",api:"https://status.github.com/api/status.json?callback=apiStatus",link:"#",jsonp:!0,callback:"githubstatus"},{name:"Dploy.io API",api:null,callback:null},{name:"Mandrill API",api:null,callback:null},{name:"Ai-Applied API",api:null,callback:null},{title:"Social Content Services"},{name:"Titter API",api:null,callback:null},{name:"Facebook API",api:null,callback:"facebookstatus"},{name:"LinkedIn API",api:null,callback:null},{name:"Sendible API",api:null,callback:null},{name:"Klout API",api:null,callback:null}],initialize:function(a){a&&$.extend(this,a)},render:function(){var a={};return this.$el.html(b.render(Templates.statusexternal,a)),this.$container=this.$el.find(".list-group").eq(0),this.services.forEach(function(a){var b;a.title?b=$("<div></div>").html(a.title).addClass("list-group-item list-group-item-info"):(b=$("<a></a>").html(a.name).addClass("list-group-item"),a.api?(b.attr("href",a.link),$.ajax({url:a.api,dataType:"jsonp",success:this[a.callback].bind(this,b)})):b.addClass("disabled")),this.$container.append(b)}.bind(this)),this},githubstatus:function(a,b){var c=$('<span class="badge"></span>').html(b.status).addClass("good"==b.status?"badge-green":"badge-red");a.prepend(c)},facebookstatus:function(a,b){console.log(b);var c=$('<span class="badge"></span>').html(b.status).addClass("good"==b.status?"badge-green":"badge-red");a.prepend(c)}});return c}),define(["mustache","Views/Pageview","Views/Panels/PlansGrid"],function(a,b,c){var d=b.extend({title:"Account Plans",render:function(){this.$el.html(a.render(Templates.pageview,{title:this.title})),this.$container=this.$el.find("#container").eq(0);var b=new c({editable:!0,limit:20,title:!1});return this.appendWidget(b,12),this}});return d}),define(["backbone","Session","Views/Navigation"],function(a,b,c){var d=a.View.extend({view:null,header:null,footer:null,initialize:function(){this.navigation=new c(this),$("#sidebar").html(this.navigation.render().el)},render:function(){return this.view?($("#page").html(this.view.render().el),this.view.$el.trigger("rendered"),this.view.finish&&this.view.finish(),void this.navigation.handleSidebarMenu()):null},setView:function(a){this.view&&this.view.remove(),b.trigger("destroy:view"),this.view=a,this.render(),b.manage()},viewshare:function(){this.share.show()},height:function(a){var b=$(window).height(),c=$(c).height();return a&&c>b?c:b},resize:function(){var a=this.height(!0);this.trigger("resize",a),$("#inner-content").css("min-height",a-42+"px")},popup_new:function(a){var b=a.render().el,c={title:a.title,actions:a.actions},d=$(Mustache.render(Templates.popup,c)).modal();d.find(".modal-body").html(b),a.actions&&d.find(".modal-footer [data-action]").on("click",function(a,b){this.trigger($(b.currentTarget).data("action"),a)}.bind(a,d)),d.on("hide",function(){this.remove()}.bind(a))},popup:function(a){var b=this,c=Templates.uipopup,d=$(c).modal();d.find(".modalcontainer").html(a.render().el),a.on("popup:close",function(){d.modal("hide")}),a.on("content:change",function(){b.trigger("content:change")})},confirm:function(a,b,c){var d={};d.message=a,d.options=[{token:"confirm",label:this.translateString("yes"),description:"Confirm your action"}],d.translate_close=this.translateString("close");var e=Mustache.render(Templates.uiconfirm,d),f=$(e),g=f.modal();f.find("[data-response=confirm]").click(function(){b(),g.modal("hide")}),f.find("[data-dismiss=modal]").click(function(){c&&c()})},alert:function(a,b){var c={};c.message=a;var d=Mustache.render(Templates.uiconfirm,c),e=$(d),f=e.modal();e.find("[data-response=confirm]").click(function(){b(),f.modal("hide")})},growl:function(a,b){$.gritter.add({title:a,text:b,time:4e3})},information:function(a,b,c){c||(c="#inner-content .container-fluid"),$(c).prepend("<div class='alert alert-info'><button type='button' class='close' data-dismiss='alert'>&times;</button><strong>"+a+"</strong> "+b+"</div>")},closeInformation:function(){$("div.alert.alert-info").remove()},dialog:function(a,b,c){var d={};d.message=a,d.options=b;for(var e=Mustache.render(Templates.uidialog,d),f=$(e),g=f.modal(),h=function(a){f.find("[data-response="+a.token+"]").click(function(){c(a),g.modal("hide")})},i=0;i<b.length;i++)h(b[i])}});return d}),define({appid:"oauth254117aa08b79a5.99870256",apiurl:"https://devapi.cloudwalkers.be/1/",authurl:"https://devapi.cloudwalkers.be/oauth2/",setloginwindow:function(){$("iframe").get(0).src=this.authurl+"authorize?response_type=token&state=xyz&client_id="+this.appid+"&redirect_uri="+origin()+"/auth.html"},hello:function(){window.location="/"},hasToken:function(){var a=window.localStorage.getItem("token");a&&a.length>9?this.hello():(a&&window.localStorage.removeItem("token"),this.setloginwindow(),window.addEventListener("message",this.receiveToken.bind(this),!1))},receiveToken:function(a){a.origin===origin()&&(a.data&&a.data.length>9?(window.localStorage.setItem("token",a.data),this.hello()):this.setloginwindow())}});var origin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname};define({appid:"oauth254a82f767f0dd8.01845977",apiurl:"https://devapi.cloudwalkers.be/1/",authurl:"https://devapi.cloudwalkers.be/oauth2/",setloginwindow:function(){$("iframe").get(0).src=this.authurl+"authorize?response_type=token&state=xyz&client_id="+this.appid+"&redirect_uri="+origin()+"/auth.html"},hello:function(){window.location="/"},hasToken:function(){var a=window.localStorage.getItem("token");a&&a.length>9?this.hello():(a&&window.localStorage.removeItem("token"),this.setloginwindow(),window.addEventListener("message",this.receiveToken.bind(this),!1))},receiveToken:function(a){a.origin===origin()&&(a.data&&a.data.length>9?(window.localStorage.setItem("token",a.data),this.hello()):this.setloginwindow())}}),require.config({baseUrl:"/js/"}),require(["lib/jquery/jquery","config"],function(a,b){b.hasToken()});var origin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname};require.config({baseUrl:"/js/",paths:{jquery:"lib/jquery/jquery",underscore:"lib/underscore/underscore",backbone:"lib/backbone/backbone",bootstrap:"lib/bootstrap/dist/js/bootstrap",mustache:"lib/mustache/mustache",backgrid:"lib/backgrid/lib/backgrid",pageable:"lib/backbone-pageable/lib/backbone-pageable","backbone.paginator":"lib/backbone.paginator/lib/backbone.paginator",paginator:"lib/backgrid-paginator/backgrid-paginator","backgrid-object-cell":"lib/backgrid-object-cell/backgrid-object-cell"},shim:{bootstrap:{deps:["jquery"],exports:"bootstrap"},underscore:{exports:"_"},backbone:{deps:["underscore","jquery","mustache"],exports:"backbone"},backgrid:{deps:["jquery","backbone","underscore"],exports:"Backgrid"},paginator:{deps:["backgrid","pageable"],exports:"Paginator"},"backgrid-object-cell":{deps:["backgrid"],exports:"ObjectCell"}}});var Cloudwalkers;require(["backbone","bootstrap","Cloudwalkers"],function(a,b,c){Store=new StorageClassIDB("cwdSuperDB",2,function(){Cloudwalkers=c.init()})}),AuthorizationError.prototype=new Error,AuthorizationError.prototype.constructor=AuthorizationError;
var origin=function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname};